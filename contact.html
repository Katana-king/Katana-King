<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katana-King - Contact Me</title>
    <meta name="description" content="Contact Katana-King for custom web development, gaming collaborations, or inquiries. Answer an incoming call or use the chat form.">
    <meta name="keywords" content="Katana-King, contact, web development, gaming, full-stack developer">
    <meta name="author" content="Katana-King">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preload" href="8.gif" as="image">
    <link rel="preload" href="menu.mp3" as="audio" type="audio/mp3">
    <link rel="preload" href="notification.mp3" as="audio" type="audio/mp3">
    <link rel="preload" href="incomingcall.mp3" as="audio" type="audio/mp3">
    <link rel="preload" href="respond.mp3" as="audio" type="audio/mp3">
    <link rel="preload" href="talk.mp3" as="audio" type="audio/mp3">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            color: #e0e0e0;
            overflow-x: hidden;
            position: relative;
            background: linear-gradient(135deg, #0f0f0f 0%, #1c2526 100%);
            transition: background 0.5s ease, color 0.5s ease;
        }
        body.crt-effect {
            background: #000;
            color: #00ff00;
            font-family: "Courier New", monospace;
        }
        body.crt-effect .content-overlay,
        body.crt-effect .contact-form,
        body.crt-effect .chat-box,
        body.crt-effect .entry-prompt-content,
        body.crt-effect .call-overlay {
            background: transparent;
            color: #00ff00;
        }
        body.crt-effect .contact-form input,
        body.crt-effect .contact-form textarea,
        body.crt-effect .chat-box .bot-message,
        body.crt-effect .chat-box .user-message {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        body.crt-effect .contact-form button,
        body.crt-effect .entry-prompt button,
        body.crt-effect .call-action-button {
            background: #003300;
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        body.crt-effect .contact-form button:hover,
        body.crt-effect .contact-form button:active,
        body.crt-effect .entry-prompt button:hover,
        body.crt-effect .entry-prompt button:active,
        body.crt-effect .call-action-button:hover,
        body.crt-effect .call-action-button:active {
            background: #004400;
        }
        body.crt-effect .typing-indicator {
            color: #00cc00;
        }
        body.crt-effect .call-overlay .call-text {
            text-shadow: 0 0 5px #00ff00;
        }
        body.crt-effect::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                rgba(18, 16, 16, 0) 50%,
                rgba(0, 0, 0, 0.25) 50%
            );
            background-size: 100% 4px;
            z-index: 1000;
            pointer-events: none;
        }
        body.crt-effect::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            z-index: 999;
            pointer-events: none;
        }
        .background-gif {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            z-index: -1;
            opacity: 0.7;
            loading: lazy;
        }
        body.crt-effect .background-gif {
            filter: brightness(0.5) contrast(1.2) sepia(1) hue-rotate(90deg) saturate(2);
            opacity: 0.3;
        }
        .content-overlay {
            position: relative;
            z-index: 1;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }
        .contact-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            width: 90%;
            display: none;
        }
        .contact-form h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
        .contact-form label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        .contact-form input,
        .contact-form textarea {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }
        .contact-form button {
            background: #ff6b6b;
            color: #e0e0e0;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 1rem;
            min-width: 120px;
        }
        .contact-form button:hover,
        .contact-form button:active {
            background: #e55a5a;
        }
        .chat-box {
            height: 300px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .message {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
            max-width: 80%;
        }
        .bot-message {
            background: #4a5568;
            border-radius: 8px;
            padding: 0.5rem 1rem;
        }
        .user-message {
            background: #2d3748;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin-left: auto;
        }
        .message img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 0.5rem;
        }
        .bot-message img {
            order: -1;
        }
        .typing-indicator {
            display: none;
            font-style: italic;
            color: #a0aec0;
        }
        .call-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            color: #e0e0e0;
        }
        .call-overlay img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 1rem;
            position: relative;
            animation: pulse 2s infinite;
        }
        .call-overlay .call-text {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            font-weight: bold;
        }
        .call-overlay .call-action-button {
            background: #ff6b6b;
            color: #e0e0e0;
            padding: 1rem 2rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
            font-size: 1.2rem;
            margin: 0.5rem;
        }
        .call-overlay .call-action-button.accept {
            background: #2ecc71;
        }
        .call-overlay .call-action-button.accept:hover,
        .call-overlay .call-action-button.accept:active {
            background: #27ae60;
            transform: scale(1.05);
        }
        .call-overlay .call-action-button.end {
            background: #e74c3c;
        }
        .call-overlay .call-action-button.end:hover,
        .call-overlay .call-action-button.end:active {
            background: #c0392b;
            transform: scale(1.05);
        }
        .call-overlay .call-buttons {
            display: flex;
            gap: 1rem;
        }
        .weak-signal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('static-noise.png') repeat;
            opacity: 0;
            pointer-events: none;
            animation: weakSignal 3s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(255, 107, 107, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }
        @keyframes weakSignal {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.3; }
        }
        #particles-js {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .entry-prompt {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            animation: fadeIn 0.5s ease-in-out;
        }
        .entry-prompt-content {
            position: relative;
            z-index: 3;
            text-align: center;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            max-width: 90%;
        }
        .entry-prompt button {
            margin-top: 1rem;
            background: #ff6b6b;
            color: #e0e0e0;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 1rem;
            min-width: 120px;
        }
        .entry-prompt button:hover,
        .entry-prompt button:active {
            background: #e55a5a;
        }
        .entry-prompt img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 2;
            opacity: 0.7;
            loading: lazy;
        }
        .controls {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 100;
            display: flex;
            gap: 1rem;
        }
        .control-button {
            background: rgba(0, 0, 0, 0.5);
            padding: 0.75rem;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .control-button:hover,
        .control-button:active {
            background: #e55a5a;
            transform: scale(1.1);
        }
        .theme-toggle {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #ff6b6b;
        }
        body.crt-effect .theme-toggle {
            background: rgba(0, 51, 0, 0.7);
            border: 1px solid #00ff00;
        }
        body.crt-effect .theme-toggle:hover,
        body.crt-effect .theme-toggle:active {
            background: #004400;
        }
        body.crt-effect .control-button svg {
            stroke: #00ff00;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @media (max-width: 768px) {
            .contact-form {
                padding: 1rem;
            }
            .contact-form h2 {
                font-size: 1.5rem;
            }
            .contact-form input,
            .contact-form textarea {
                font-size: 0.9rem;
            }
            .contact-form button,
            .call-action-button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            .entry-prompt-content {
                padding: 1rem;
            }
            .entry-prompt button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            .control-button {
                width: 40px;
                height: 40px;
                padding: 0.5rem;
            }
            .control-button svg {
                width: 20px;
                height: 20px;
            }
            .message img {
                width: 32px;
                height: 32px;
            }
            .call-overlay img {
                width: 80px;
                height: 80px;
            }
            .call-overlay .call-text {
                font-size: 1.2rem;
            }
            .call-overlay .call-action-button {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <img src="8.gif" alt="Contact background animation" class="background-gif" loading="lazy">
    <div id="particles-js"></div>

    <!-- Entry Prompt -->
    <div class="entry-prompt" id="entryPrompt" role="dialog" aria-labelledby="entryPromptTitle">
        <div id="particles-js"></div>
        <img src="8.gif" alt="Welcome animation for contact page" loading="lazy">
        <div class="entry-prompt-content">
            <h2 id="entryPromptTitle" class="text-xl md:text-2xl font-bold mb-4">Contact Katana-King</h2>
            <p>Would you like to enter the contact page or go back?</p>
            <div class="flex gap-4 mt-4">
                <button onclick="enterSite()" aria-label="Enter the contact page">Enter</button>
                <button onclick="goBack()" aria-label="Go back to previous page">Back</button>
            </div>
        </div>
    </div>

    <!-- Call Overlay -->
    <div class="call-overlay" id="callOverlay">
        <div class="weak-signal" id="weakSignal"></div>
        <img src="katana-king-avatar.png" alt="Katana-King avatar" loading="lazy">
        <div class="call-text" id="callText">Incoming Call from Katana-King...</div>
        <div class="call-buttons" id="callButtons">
            <button class="call-action-button accept" onclick="acceptCall()" aria-label="Accept call">✅ Accept</button>
            <button class="call-action-button end" onclick="declineCall()" aria-label="Decline call">❌ Decline</button>
        </div>
    </div>

    <!-- Contact Form -->
    <div class="content-overlay">
        <div class="contact-form" id="contactForm">
            <h2>Contact Me</h2>
            <div id="initialForm">
                <label for="name">Name</label>
                <input type="text" id="name" name="name" required placeholder="Your name">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required placeholder="Your email">
                <div class="flex gap-4 justify-center">
                    <button onclick="startChat()" aria-label="Start chat">Start Chat</button>
                    <button onclick="window.location.href='index.html'" aria-label="Go back to home page">Back to Home</button>
                </div>
            </div>
            <div id="chatInterface" style="display: none;">
                <div class="chat-header">
                    <h3 class="text-lg font-semibold">Chat with Katana-King</h3>
                </div>
                <div id="chatBox" class="chat-box">
                    <div id="typingIndicator" class="typing-indicator">Katana-King is typing...</div>
                </div>
                <form id="messageForm" action="https://formsubmit.co/brahimiahmed995@gmail.com" method="POST">
                    <input type="hidden" id="formName" name="name">
                    <input type="hidden" id="formEmail" name="email">
                    <textarea id="message" name="message" required placeholder="Type your message..." rows="4"></textarea>
                    <div class="flex gap-4 justify-center">
                        <button type="submit" aria-label="Send message">Send Message</button>
                        <button type="button" onclick="window.location.href='index.html'" aria-label="Go back to home page">Back to Home</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <audio id="backgroundAudio" loop aria-hidden="true">
        <source src="menu.mp3" type="audio/mp3">
        Your browser does not support the audio tag. <a href="menu.mp3" download>Download audio</a> to play manually.
    </audio>
    <audio id="notificationSound" aria-hidden="true">
        <source src="notification.mp3" type="audio/mp3">
        Your browser does not support the audio tag.
    </audio>
    <audio id="incomingCallSound" loop aria-hidden="true">
        <source src="incomingcall.mp3" type="audio/mp3">
        Your browser does not support the audio tag.
    </audio>
    <audio id="respondSound" aria-hidden="true">
        <source src="respond.mp3" type="audio/mp3">
        Your browser does not support the audio tag.
    </audio>
    <audio id="talkSound" aria-hidden="true">
        <source src="talk.mp3" type="audio/mp3">
        Your browser does not support the audio tag.
    </audio>

    <div class="controls">
        <button class="control-button mute-toggle" title="Toggle Mute Audio" onclick="toggleMute()" aria-label="Toggle background audio mute">
            <svg id="muteIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
            </svg>
        </button>
        <button class="control-button theme-toggle" title="Toggle Theme" onclick="toggleTheme()" aria-label="Toggle between dark and retro CRT theme">
            <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e0e0e0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
        </button>
    </div>

    <script>
        // Initialize particles.js
        window.addEventListener('load', () => {
            particlesJS('particles-js', {
                particles: {
                    number: { value: window.innerWidth < 768 ? 30 : 50, density: { enable: true, value_area: 800 } },
                    color: { value: '#ff6b6b' },
                    shape: { type: 'circle', stroke: { width: 0, color: '#000000' } },
                    opacity: { value: 0.5, random: true, anim: { enable: true, speed: 0.7, opacity_min: 0.1 } },
                    size: { value: 3, random: true, anim: { enable: false } },
                    line_linked: { enable: true, distance: 100, color: '#ff6b6b', opacity: 0.3, width: 1 },
                    move: { enable: true, speed: 3, direction: 'none', random: true, straight: false, out_mode: 'out' }
                },
                interactivity: {
                    detect_on: 'canvas',
                    events: {
                        onhover: { enable: window.innerWidth >= 768, mode: 'grab' },
                        onclick: { enable: true, mode: 'push' },
                        resize: true
                    },
                    modes: {
                        grab: { distance: 150, line_linked: { opacity: 0.5 } },
                        push: { particles_nb: 2 }
                    }
                },
                retina_detect: true
            });
        });

        // Elements
        const audio = document.getElementById('backgroundAudio');
        const notificationSound = document.getElementById('notificationSound');
        const incomingCallSound = document.getElementById('incomingCallSound');
        const respondSound = document.getElementById('respondSound');
        const talkSound = document.getElementById('talkSound');
        const muteIcon = document.getElementById('muteIcon');
        const themeIcon = document.getElementById('themeIcon');
        const entryPrompt = document.getElementById('entryPrompt');
        const contactForm = document.getElementById('contactForm');
        const callOverlay = document.getElementById('callOverlay');
        const callText = document.getElementById('callText');
        const weakSignal = document.getElementById('weakSignal');
        const callButtons = document.getElementById('callButtons');

        // Initial state
        audio.muted = true;
        notificationSound.muted = false;
        incomingCallSound.muted = false;
        respondSound.muted = false;
        talkSound.muted = false;
        contactForm.style.display = 'none';
        callOverlay.style.display = 'none';

        // Enter site and trigger incoming call
        function enterSite() {
            console.log('enterSite called');
            try {
                entryPrompt.style.display = 'none';
                callOverlay.style.display = 'flex';
                callText.textContent = 'Incoming Call from Katana-King...';
                callButtons.style.display = 'flex';
                if (!incomingCallSound.muted) {
                    incomingCallSound.currentTime = 0;
                    incomingCallSound.play().catch(error => {
                        console.error("Incoming call sound play failed:", error);
                        // Fallback: proceed to call overlay even if audio fails
                        callOverlay.style.display = 'flex';
                    });
                }
                audio.play().catch(error => console.error("Background audio play failed:", error));
            } catch (error) {
                console.error("Error in enterSite:", error);
                // Fallback: show contact form if something goes wrong
                entryPrompt.style.display = 'none';
                callOverlay.style.display = 'none';
                contactForm.style.display = 'block';
                document.getElementById('initialForm').style.display = 'block';
            }
        }

        // Go back
        function goBack() {
            console.log('goBack called');
            window.history.back();
        }

        // Toggle mute
        function toggleMute() {
            console.log('toggleMute called, muted:', audio.muted);
            audio.muted = !audio.muted;
            notificationSound.muted = audio.muted;
            incomingCallSound.muted = audio.muted;
            respondSound.muted = audio.muted;
            talkSound.muted = audio.muted;
            muteIcon.innerHTML = audio.muted
                ? `<path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M15.54 8.46l-6 6"></path><path d="M18.54 5.46l-6 6"></path>`
                : `<path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>`;
        }

        // Toggle theme
        function toggleTheme() {
            console.log('toggleTheme called');
            document.body.classList.toggle('crt-effect');
            const isCrt = document.body.classList.contains('crt-effect');
            themeIcon.innerHTML = isCrt
                ? `<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M6 16h12"></path><rect x="10" y="17" width="4" height="3"></rect>`
                : `<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line>`;
            localStorage.setItem('theme', isCrt ? 'crt' : 'dark');
        }

        // Load saved theme
        window.addEventListener('load', () => {
            console.log('Window loaded, checking saved theme');
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'crt') {
                document.body.classList.add('crt-effect');
                themeIcon.innerHTML = `<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M6 16h12"></path><rect x="10" y="17" width="4" height="3"></rect>`;
            }
        });

        // Call functionality
        let callTimerInterval;
        function acceptCall() {
            console.log('acceptCall called');
            try {
                incomingCallSound.pause();
                callText.textContent = 'In Call – 00:00';
                callButtons.innerHTML = `<button class="call-action-button end" onclick="declineCall()" aria-label="End call">❌ End</button>`;
                if (!respondSound.muted) {
                    respondSound.currentTime = 0;
                    respondSound.play().then(() => {
                        if (!talkSound.muted) {
                            talkSound.currentTime = 0;
                            talkSound.play().catch(error => {
                                console.error("Talk sound play failed:", error);
                                // Fallback: end call after 5 seconds if audio fails
                                setTimeout(() => {
                                    console.log('Fallback: ending call due to talk sound failure');
                                    declineCall();
                                }, 5000);
                            });
                            // Listen for when talk.mp3 finishes
                            talkSound.onended = () => {
                                console.log('talkSound ended, waiting 2 seconds');
                                setTimeout(() => {
                                    console.log('Ending call after 2-second delay');
                                    declineCall();
                                }, 2000); // 2-second delay after talk.mp3 ends
                            };
                        }
                    }).catch(error => {
                        console.error("Respond sound play failed:", error);
                        // Fallback: end call after 5 seconds if audio fails
                        setTimeout(() => {
                            console.log('Fallback: ending call due to respond sound failure');
                            declineCall();
                        }, 5000);
                    });
                }
                let seconds = 0;
                callTimerInterval = setInterval(() => {
                    seconds++;
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    callText.textContent = `In Call – ${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }, 1000);
                // Trigger weak signal animation intermittently
                setInterval(() => {
                    weakSignal.style.animation = 'none';
                    setTimeout(() => {
                        weakSignal.style.animation = 'weakSignal 3s infinite';
                    }, 100);
                }, 10000);
            } catch (error) {
                console.error("Error in acceptCall:", error);
                // Fallback: show contact form if something goes wrong
                declineCall();
            }
        }

        function declineCall() {
            console.log('declineCall called');
            try {
                incomingCallSound.pause();
                respondSound.pause();
                talkSound.pause();
                clearInterval(callTimerInterval);
                callOverlay.style.display = 'none';
                weakSignal.style.animation = 'none';
                contactForm.style.display = 'block';
                document.getElementById('initialForm').style.display = 'block';
                document.querySelector('.content-overlay').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error("Error in declineCall:", error);
                // Ensure contact form is visible even if error occurs
                callOverlay.style.display = 'none';
                contactForm.style.display = 'block';
                document.getElementById('initialForm').style.display = 'block';
            }
        }

        // Start chat
        function startChat() {
            console.log('startChat called');
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            if (!name || !email) {
                alert('Please enter both name and email.');
                return;
            }
            document.getElementById('initialForm').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'block';
            document.getElementById('formName').value = name;
            document.getElementById('formEmail').value = email;
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'block';
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                addMessage('bot', 'Hello, how can I help you?', 'katana-king-avatar.png');
                playNotificationSound();
            }, 1500);
        }

        // Play notification sound
        function playNotificationSound() {
            console.log('playNotificationSound called');
            if (!notificationSound.muted) {
                notificationSound.currentTime = 0;
                notificationSound.play().catch(error => console.error("Notification sound play failed:", error));
            }
        }

        // Add message to chat
        function addMessage(sender, text, avatar = 'user-avatar.png') {
            console.log(`addMessage called, sender: ${sender}, text: ${text}`);
            const chatBox = document.getElementById('chatBox');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'bot' ? 'bot-message' : 'user-message'}`;
            messageDiv.innerHTML = `<img src="${sender === 'bot' ? 'katana-king-avatar.png' : 'user-avatar.png'}" alt="${sender === 'bot' ? 'Katana-King' : 'User'} avatar"> ${text}`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
            if (sender === 'user') {
                saveMessage(text);
                playNotificationSound();
            }
        }

        // Save message to localStorage
        function saveMessage(message) {
            console.log('saveMessage called');
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const messages = JSON.parse(localStorage.getItem('contactMessages') || '[]');
            messages.push({ name, email, message, timestamp: new Date().toISOString() });
            localStorage.setItem('contactMessages', JSON.stringify(messages));
        }

        // Handle form submission
        document.getElementById('messageForm').addEventListener('submit', function(event) {
            console.log('messageForm submitted');
            const message = document.getElementById('message').value.trim();
            if (!message) {
                event.preventDefault();
                alert('Please enter a message.');
                return;
            }
            addMessage('user', message, 'user-avatar.png');
        });
    </script>
</body>
</html>
